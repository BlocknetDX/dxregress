// Copyright Â© 2017 The Blocknet Developers
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package chain

import (
	"encoding/base64"

	"github.com/sirupsen/logrus"
)

const GenesisPatchFile = "dxregress.patch"

// GenesisPatchV1 contains the patch for enabling the new test environment blockchain.
func GenesisPatchV1() string {
	patch := `ZGlmZiAtLWdpdCBhL3NyYy9jaGFpbnBhcmFtcy5jcHAgYi9zcmMvY2hhaW5wYXJh
bXMuY3BwCmluZGV4IGY0NGJkMmU4Yi4uYmVlYmYyMDA4IDEwMDY0NAotLS0gYS9z
cmMvY2hhaW5wYXJhbXMuY3BwCisrKyBiL3NyYy9jaGFpbnBhcmFtcy5jcHAKQEAg
LTE5NCwzMiArMTk0LDUwIEBAIHB1YmxpYzoKICAgICAgICAgcGNoTWVzc2FnZVN0
YXJ0WzFdID0gMHg3NjsKICAgICAgICAgcGNoTWVzc2FnZVN0YXJ0WzJdID0gMHg2
NTsKICAgICAgICAgcGNoTWVzc2FnZVN0YXJ0WzNdID0gMHhiYTsKLSAgICAgICAg
dkFsZXJ0UHViS2V5ID0gUGFyc2VIZXgoIjAwMDAxMGU4M2IyNzAzY2NmMzIyZjdk
YmQ2MmRkNTg1NWFjN2MxMGJkMDU1ODE0Y2UxMjFiYTMyNjA3ZDU3M2I4ODEwYzAy
YzA1ODJhZWQwNWI0ZGViOWM0Yjc3YjI2ZDkyNDI4YzYxMjU2Y2Q0Mjc3NGJhYmVh
MGEwNzNiMmVkMGM5Iik7Ci0gICAgICAgIG5EZWZhdWx0UG9ydCA9IDQxNDc0Owor
Ly8gICAgICAgIHZBbGVydFB1YktleSA9IFBhcnNlSGV4KCIwMDAwMTBlODNiMjcw
M2NjZjMyMmY3ZGJkNjJkZDU4NTVhYzdjMTBiZDA1NTgxNGNlMTIxYmEzMjYwN2Q1
NzNiODgxMGMwMmMwNTgyYWVkMDViNGRlYjljNGI3N2IyNmQ5MjQyOGM2MTI1NmNk
NDI3NzRiYWJlYTBhMDczYjJlZDBjOSIpOworICAgICAgICBuRGVmYXVsdFBvcnQg
PSA0MTQ3NjsKICAgICAgICAgbkVuZm9yY2VCbG9ja1VwZ3JhZGVNYWpvcml0eSA9
IDUxOwogICAgICAgICBuUmVqZWN0QmxvY2tPdXRkYXRlZE1ham9yaXR5ID0gNzU7
CiAgICAgICAgIG5Ub0NoZWNrQmxvY2tVcGdyYWRlTWFqb3JpdHkgPSAxMDA7CiAg
ICAgICAgIG5NaW5lclRocmVhZHMgPSAwOwotICAgICAgICBuVGFyZ2V0VGltZXNw
YW4gPSAxICogNjA7IC8vIEJsb2NrbmV0RFg6IDEgZGF5Ci0gICAgICAgIG5UYXJn
ZXRTcGFjaW5nID0gMSAqIDYwOyAgLy8gQmxvY2tuZXREWDogMSBtaW51dGUKLSAg
ICAgICAgbkxhc3RQT1dCbG9jayA9IDIwMDA7Ci0gICAgICAgIG5NYXR1cml0eSA9
IDE1OwotICAgICAgICBuTW9kaWZpZXJVcGRhdGVCbG9jayA9IDUxMTk3OyAvL2Fw
cHJveCBNb24sIDE3IEFwciAyMDE3IDA0OjAwOjAwIEdNVAorICAgICAgICBuVGFy
Z2V0VGltZXNwYW4gPSA2MDsgLy8gQmxvY2tuZXREWDogMSBtaW51dGUKKyAgICAg
ICAgblRhcmdldFNwYWNpbmcgPSAzMDsgIC8vIEJsb2NrbmV0RFg6IDMwIHNlY29u
ZHMKKyAgICAgICAgbkxhc3RQT1dCbG9jayA9IDUwOworICAgICAgICBuTWF0dXJp
dHkgPSAxMDsKKyAgICAgICAgbk1vZGlmaWVyVXBkYXRlQmxvY2sgPSAyXjMyOwog
CiAgICAgICAgIC8vISBNb2RpZnkgdGhlIHRlc3RuZXQgZ2VuZXNpcyBibG9jayBz
byB0aGUgdGltZXN0YW1wIGlzIHZhbGlkIGZvciBhIGxhdGVyIHN0YXJ0LgotICAg
ICAgICBnZW5lc2lzLm5UaW1lID0gMTUwMzU3MTAwMDsKLSAgICAgICAgZ2VuZXNp
cy5uTm9uY2UgPSAyMTU4OTYyOworICAgICAgICBiblByb29mT2ZXb3JrTGltaXQg
PSB+dWludDI1NigpID4+IDIwOyAvLyBCbG9ja25ldERYIHN0YXJ0aW5nIGRpZmZp
Y3VsdHkgaXMgMSAvIDJeMTIKKyAgICAgICAgY29uc3QgY2hhciogcHN6VGltZXN0
YW1wID0gInByaXZhdGVuZXQiOworICAgICAgICBnZW5lc2lzLmhhc2hQcmV2Qmxv
Y2sgPSAwOworICAgICAgICBnZW5lc2lzLmhhc2hNZXJrbGVSb290ID0gZ2VuZXNp
cy5CdWlsZE1lcmtsZVRyZWUoKTsKKyAgICAgICAgZ2VuZXNpcy5uVmVyc2lvbiA9
IDE7CisgICAgICAgIGdlbmVzaXMublRpbWUgPSAxNTA5MTYzMDY3OworICAgICAg
ICBnZW5lc2lzLm5CaXRzID0gYm5Qcm9vZk9mV29ya0xpbWl0LkdldENvbXBhY3Qo
KTsKKyAgICAgICAgZ2VuZXNpcy5uTm9uY2UgPSAxNTM5NDIzOworCisvLyAgICAg
ICAgYm9vbCBkb25lID0gZmFsc2U7CisvLyAgICAgICAgd2hpbGUgKCFkb25lKSB7
CisvLyAgICAgICAgICAgIGJvb2wgZk5lZ2F0aXZlOworLy8gICAgICAgICAgICBi
b29sIGZPdmVyZmxvdzsKKy8vICAgICAgICAgICAgdWludDI1NiBiblRhcmdldDsK
Ky8vICAgICAgICAgICAgYm5UYXJnZXQuU2V0Q29tcGFjdChnZW5lc2lzLm5CaXRz
LCAmZk5lZ2F0aXZlLCAmZk92ZXJmbG93KTsKKy8vICAgICAgICAgICAgZG9uZSA9
IGdlbmVzaXMuR2V0SGFzaCgpIDw9IGJuVGFyZ2V0OworLy8gICAgICAgICAgICBp
ZiAoIWRvbmUpIHsKKy8vICAgICAgICAgICAgICAgIGdlbmVzaXMubk5vbmNlICs9
IDE7CisvLyAgICAgICAgICAgIH0KKy8vICAgICAgICB9CiAKICAgICAgICAgaGFz
aEdlbmVzaXNCbG9jayA9IGdlbmVzaXMuR2V0SGFzaCgpOwotICAgICAgICBhc3Nl
cnQoaGFzaEdlbmVzaXNCbG9jayA9PSB1aW50MjU2KCIweDAwMDAwZjkwYWMyNjA4
NTllNDUxNTM1NjcxOWQ5NGM5ZmI4Y2FkYjFhM2RkYTE4NmE2NGFjNDFjZTRjM2M3
YTciKSk7CisgICAgICAgIHN0ZDo6Y291dCA8PCBoYXNoR2VuZXNpc0Jsb2NrLlRv
U3RyaW5nKCkgPDwgIiBub25jZTogIiA8PCBnZW5lc2lzLm5Ob25jZSA8PCBzdGQ6
OmVuZGw7CisgICAgICAgIGFzc2VydChoYXNoR2VuZXNpc0Jsb2NrID09IHVpbnQy
NTYoIjAwMDAwZDc1ODlhYzgyYzBiYjdiMTU2OWFkMTIwODRkZTI0ZTM4MGI5ZTJm
MDkzNmZjYTA0YTc4MjQxZGY0OTAiKSk7CiAKICAgICAgICAgdkZpeGVkU2VlZHMu
Y2xlYXIoKTsKICAgICAgICAgdlNlZWRzLmNsZWFyKCk7Ci0JCi0JCi0gICAgICAg
IHZTZWVkcy5wdXNoX2JhY2soQ0ROU1NlZWREYXRhKCIxNzguNjIuOTAuMjEzIiwg
IjE3OC42Mi45MC4yMTMiKSk7IC8vIHNlZWQgbm9kZQotICAgICAgICB2U2VlZHMu
cHVzaF9iYWNrKENETlNTZWVkRGF0YSgiMTM4LjE5Ny43My4yMTQiLCAiMTM4LjE5
Ny43My4yMTQiKSk7IC8vIHNlZWQgbm9kZQotICAgICAgICB2U2VlZHMucHVzaF9i
YWNrKENETlNTZWVkRGF0YSgiMzQuMjM1LjQ5LjI0OCIsICIzNC4yMzUuNDkuMjQ4
IikpOyAvLyBzZWVkIG5vZGUKKworLy8gICAgICAgIHZTZWVkcy5wdXNoX2JhY2so
Q0ROU1NlZWREYXRhKCIxNzguNjIuOTAuMjEzIiwgIjE3OC42Mi45MC4yMTMiKSk7
IC8vIHNlZWQgbm9kZQorLy8gICAgICAgIHZTZWVkcy5wdXNoX2JhY2soQ0ROU1Nl
ZWREYXRhKCIxMzguMTk3LjczLjIxNCIsICIxMzguMTk3LjczLjIxNCIpKTsgLy8g
c2VlZCBub2RlCisvLyAgICAgICAgdlNlZWRzLnB1c2hfYmFjayhDRE5TU2VlZERh
dGEoIjM0LjIzNS40OS4yNDgiLCAiMzQuMjM1LjQ5LjI0OCIpKTsgLy8gc2VlZCBu
b2RlCiAKICAgICAgICAgYmFzZTU4UHJlZml4ZXNbUFVCS0VZX0FERFJFU1NdID0g
c3RkOjp2ZWN0b3I8dW5zaWduZWQgY2hhcj4oMSwgMTM5KTsgLy8gVGVzdG5ldCBi
bG9ja25ldGR4IGFkZHJlc3NlcyBzdGFydCB3aXRoICd4JyBvciAneScKICAgICAg
ICAgYmFzZTU4UHJlZml4ZXNbU0NSSVBUX0FERFJFU1NdID0gc3RkOjp2ZWN0b3I8
dW5zaWduZWQgY2hhcj4oMSwgMTkpOyAgLy8gVGVzdG5ldCBibG9ja25ldGR4IHNj
cmlwdCBhZGRyZXNzZXMgc3RhcnQgd2l0aCAnOCcgb3IgJzknCkBAIC0yMzEsMTgg
KzI0OSwyMCBAQCBwdWJsaWM6CiAgICAgICAgIC8vIFRlc3RuZXQgYmxvY2tuZXRk
eCBCSVA0NCBjb2luIHR5cGUgaXMgJzEnIChBbGwgY29pbidzIHRlc3RuZXQgZGVm
YXVsdCkKICAgICAgICAgYmFzZTU4UHJlZml4ZXNbRVhUX0NPSU5fVFlQRV0gPSBi
b29zdDo6YXNzaWduOjpsaXN0X29mKDB4ODApKDB4MDApKDB4MDApKDB4MDEpLmNv
bnZlcnRfdG9fY29udGFpbmVyPHN0ZDo6dmVjdG9yPHVuc2lnbmVkIGNoYXI+ID4o
KTsKIAotICAgICAgICBjb252ZXJ0U2VlZDYodkZpeGVkU2VlZHMsIHBuU2VlZDZf
dGVzdCwgQVJSQVlMRU4ocG5TZWVkNl90ZXN0KSk7CisvLyAgICAgICAgY29udmVy
dFNlZWQ2KHZGaXhlZFNlZWRzLCBwblNlZWQ2X3Rlc3QsIEFSUkFZTEVOKHBuU2Vl
ZDZfdGVzdCkpOwogCiAgICAgICAgIGZSZXF1aXJlUlBDUGFzc3dvcmQgPSB0cnVl
OwotICAgICAgICBmTWluaW5nUmVxdWlyZXNQZWVycyA9IHRydWU7Ci0gICAgICAg
IGZBbGxvd01pbkRpZmZpY3VsdHlCbG9ja3MgPSB0cnVlOworICAgICAgICBmTWlu
aW5nUmVxdWlyZXNQZWVycyA9IGZhbHNlOworICAgICAgICBmQWxsb3dNaW5EaWZm
aWN1bHR5QmxvY2tzID0gZmFsc2U7CiAgICAgICAgIGZEZWZhdWx0Q29uc2lzdGVu
Y3lDaGVja3MgPSBmYWxzZTsKLSAgICAgICAgZlJlcXVpcmVTdGFuZGFyZCA9IGZh
bHNlOwotICAgICAgICBmTWluZUJsb2Nrc09uRGVtYW5kID0gZmFsc2U7Ci0gICAg
ICAgIGZUZXN0bmV0VG9CZURlcHJlY2F0ZWRGaWVsZFJQQyA9IHRydWU7CisgICAg
ICAgIGZSZXF1aXJlU3RhbmRhcmQgPSB0cnVlOworICAgICAgICBmTWluZUJsb2Nr
c09uRGVtYW5kID0gdHJ1ZTsKKyAgICAgICAgZlNraXBQcm9vZk9mV29ya0NoZWNr
ID0gdHJ1ZTsKKyAgICAgICAgZlRlc3RuZXRUb0JlRGVwcmVjYXRlZEZpZWxkUlBD
ID0gZmFsc2U7CisgICAgICAgIGZIZWFkZXJzRmlyc3RTeW5jaW5nQWN0aXZlID0g
ZmFsc2U7CiAKICAgICAgICAgblBvb2xNYXhUcmFuc2FjdGlvbnMgPSAyOwotICAg
ICAgICBzdHJTcG9ya0tleSA9ICIwNDU2NWY0MjliOGM2OGRhYmRjZGYwOTYwOGJl
MDViNGExMGZjNzA0ZjdkZTE4NjZhYWVlZDI4YTcyOWVjNWI4YzQxOGQ5MGY5NTEw
YmExMTVjMGYzNWYzNTNiMWFlYTk4M2ZlOTkzOTdkMWMyMDY4NWQ2YWIzZWQwZDBi
N2JhM2VhIjsKKyAgICAgICAgc3RyU3BvcmtLZXkgPSAiMDQ2YWU3ZGU3YzhmNmJi
MmU2YmNiYzFkYmRiNzFjYzQzNDFlYzRiNGVjOWYxZDdhMTZiNmJjYzYxYzQ2MGQ1
NDIxYWZlMWIwNDg3YWNjYzQ2ZjJlZTAwNDQ5Mjc3ZjliMjE2MWU1ZTUxZWJmYjA4
YTNjNTM2MWI4MTFlYTIyZDNiOSI7CiAgICAgICAgIHN0ck9iZnVzY2F0aW9uUG9v
bER1bW15QWRkcmVzcyA9ICJ5NTdjcWZHUmtla1J5RFJOZUppTHRZVkVidmhYck5i
bW94IjsKICAgICAgICAgblN0YXJ0U2VydmljZW5vZGVQYXltZW50cyA9IDE0MjA4
Mzc1NTg7IC8vRnJpLCAwOSBKYW4gMjAxNSAyMTowNTo1OCBHTVQKICAgICB9CmRp
ZmYgLS1naXQgYS9zcmMvaW5pdC5jcHAgYi9zcmMvaW5pdC5jcHAKaW5kZXggMjVi
OWNlNzNlLi4wMGJlMDkwNzIgMTAwNjQ0Ci0tLSBhL3NyYy9pbml0LmNwcAorKysg
Yi9zcmMvaW5pdC5jcHAKQEAgLTM1MSw3ICszNTEsNyBAQCBzdGQ6OnN0cmluZyBI
ZWxwTWVzc2FnZShIZWxwTWVzc2FnZU1vZGUgbW9kZSkKICAgICBzdHJVc2FnZSAr
PSBIZWxwTWVzc2FnZU9wdCgiLW9ubHluZXQ9PG5ldD4iLCBfKCJPbmx5IGNvbm5l
Y3QgdG8gbm9kZXMgaW4gbmV0d29yayA8bmV0PiAoaXB2NCwgaXB2NiBvciBvbmlv
bikiKSk7CiAgICAgc3RyVXNhZ2UgKz0gSGVscE1lc3NhZ2VPcHQoIi1wZXJtaXRi
YXJlbXVsdGlzaWciLCBzdHJwcmludGYoXygiUmVsYXkgbm9uLVAyU0ggbXVsdGlz
aWcgKGRlZmF1bHQ6ICV1KSIpLCAxKSk7CiAgICAgc3RyVXNhZ2UgKz0gSGVscE1l
c3NhZ2VPcHQoIi1wZWVyYmxvb21maWx0ZXJzIiwgc3RycHJpbnRmKF8oIlN1cHBv
cnQgZmlsdGVyaW5nIG9mIGJsb2NrcyBhbmQgdHJhbnNhY3Rpb24gd2l0aCBibG9v
bSBmaWx0ZXJzIChkZWZhdWx0OiAldSkiKSwgZmFsc2UpKTsKLSAgICBzdHJVc2Fn
ZSArPSBIZWxwTWVzc2FnZU9wdCgiLXBvcnQ9PHBvcnQ+Iiwgc3RycHJpbnRmKF8o
Ikxpc3RlbiBmb3IgY29ubmVjdGlvbnMgb24gPHBvcnQ+IChkZWZhdWx0OiAldSBv
ciB0ZXN0bmV0OiAldSkiKSwgNDE0MTIsIDQxNDc0KSk7CisgICAgc3RyVXNhZ2Ug
Kz0gSGVscE1lc3NhZ2VPcHQoIi1wb3J0PTxwb3J0PiIsIHN0cnByaW50ZihfKCJM
aXN0ZW4gZm9yIGNvbm5lY3Rpb25zIG9uIDxwb3J0PiAoZGVmYXVsdDogJXUgb3Ig
dGVzdG5ldDogJXUpIiksIDQxNDEyLCA0MTQ3NikpOwogICAgIHN0clVzYWdlICs9
IEhlbHBNZXNzYWdlT3B0KCItcHJveHk9PGlwOnBvcnQ+IiwgXygiQ29ubmVjdCB0
aHJvdWdoIFNPQ0tTNSBwcm94eSIpKTsKICAgICBzdHJVc2FnZSArPSBIZWxwTWVz
c2FnZU9wdCgiLXNlZWRub2RlPTxpcD4iLCBfKCJDb25uZWN0IHRvIGEgbm9kZSB0
byByZXRyaWV2ZSBwZWVyIGFkZHJlc3NlcywgYW5kIGRpc2Nvbm5lY3QiKSk7CiAg
ICAgc3RyVXNhZ2UgKz0gSGVscE1lc3NhZ2VPcHQoIi10aW1lb3V0PTxuPiIsIHN0
cnByaW50ZihfKCJTcGVjaWZ5IGNvbm5lY3Rpb24gdGltZW91dCBpbiBtaWxsaXNl
Y29uZHMgKG1pbmltdW06IDEsIGRlZmF1bHQ6ICVkKSIpLCBERUZBVUxUX0NPTk5F
Q1RfVElNRU9VVCkpOwpkaWZmIC0tZ2l0IGEvc3JjL21haW4uY3BwIGIvc3JjL21h
aW4uY3BwCmluZGV4IDRiYzZiY2ZhZC4uNmNjMDljNTdhIDEwMDY0NAotLS0gYS9z
cmMvbWFpbi5jcHAKKysrIGIvc3JjL21haW4uY3BwCkBAIC03Myw3ICs3Myw3IEBA
IHVuc2lnbmVkIGludCBuQ29pbkNhY2hlU2l6ZSA9IDUwMDA7CiBib29sIGZBbGVy
dHMgPSBERUZBVUxUX0FMRVJUUzsKIENvaW5WYWxpZGF0b3IgJmNvaW5WYWxpZGF0
b3IgPSBDb2luVmFsaWRhdG9yOjppbnN0YW5jZSgpOwogCi11bnNpZ25lZCBpbnQg
blN0YWtlTWluQWdlID0gNjAgKiA2MDsKK3Vuc2lnbmVkIGludCBuU3Rha2VNaW5B
Z2UgPSAzMDsgLy8gc2Vjb25kcwogaW50NjRfdCBuUmVzZXJ2ZUJhbGFuY2UgPSAw
OwogCiAvKiogRmVlcyBzbWFsbGVyIHRoYW4gdGhpcyAoaW4gZHVmZnMpIGFyZSBj
b25zaWRlcmVkIHplcm8gZmVlIChmb3IgcmVsYXlpbmcgYW5kIG1pbmluZykKQEAg
LTE2NTUsOCArMTY1NSw4IEBAIGludDY0X3QgR2V0QmxvY2tWYWx1ZShpbnQgbkhl
aWdodCkKICAgICBpbnQ2NF90IG5TdWJzaWR5ID0gMDsKIAogICAgIGlmIChQYXJh
bXMoKS5OZXR3b3JrSUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpURVNUTkVUKSB7
Ci0gICAgICAgIGlmIChuSGVpZ2h0IDwgMjAwICYmIG5IZWlnaHQgPiAwKQotICAg
ICAgICAgICAgcmV0dXJuIDI1MDAwMCAqIENPSU47CisgICAgICAgIGlmIChuSGVp
Z2h0IDw9IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkpCisgICAgICAgICAgICBy
ZXR1cm4gMTAwMDAgKiBDT0lOOwogICAgIH0KIAogICAgIC8vIFJlZHVjZSBSZXdh
cmQgc3RhcnRpbmcgeWVhciAxCkBAIC0xNjg0LDEzICsxNjg0LDEzIEBAIGludDY0
X3QgR2V0U2VydmljZW5vZGVQYXltZW50KGludCBuSGVpZ2h0LCBpbnQ2NF90IGJs
b2NrVmFsdWUsIGludCBuU2VydmljZW5vZGVDCiAgICAgaW50NjRfdCByZXQgPSAw
OwogCiAgICAgaWYgKFBhcmFtcygpLk5ldHdvcmtJRCgpID09IENCYXNlQ2hhaW5Q
YXJhbXM6OlRFU1RORVQpIHsKLSAgICAgICAgaWYgKG5IZWlnaHQgPCAyMDApCisg
ICAgICAgIGlmIChuSGVpZ2h0IDw9IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkp
CiAgICAgICAgICAgICByZXR1cm4gMDsKICAgICB9CiAKLSAgICBpZiAobkhlaWdo
dCA8PSAyNjUwKSB7Ci0gICAgICAgIHJldCA9IGJsb2NrVmFsdWUgLyA1OwotICAg
IH0gZWxzZSBpZiAobkhlaWdodCA+IDI2NTApIHsKKy8vICAgIGlmIChuSGVpZ2h0
IDw9IDI2NTApIHsKKy8vICAgICAgICByZXQgPSBibG9ja1ZhbHVlIC8gNTsKKy8v
ICAgIH0gZWxzZSBpZiAobkhlaWdodCA+IDI2NTApIHsKICAgICAgICAgaW50NjRf
dCBuTW9uZXlTdXBwbHkgPSBjaGFpbkFjdGl2ZS5UaXAoKS0+bk1vbmV5U3VwcGx5
OwogICAgICAgICBpbnQ2NF90IG1Ob2RlQ29pbnMgPSBtbm9kZW1hbi5zaXplKCkg
KiAxMDAwMCAqIENPSU47CiAKQEAgLTE3MDIsMTIgKzE3MDIsMTMgQEAgaW50NjRf
dCBHZXRTZXJ2aWNlbm9kZVBheW1lbnQoaW50IG5IZWlnaHQsIGludDY0X3QgYmxv
Y2tWYWx1ZSwgaW50IG5TZXJ2aWNlbm9kZUMKICAgICAgICAgICAgIExvZ1ByaW50
ZigiR2V0U2VydmljZW5vZGVQYXltZW50KCk6IG1vbmV5c3VwcGx5PSVzLCBub2Rl
Y29pbnM9JXMgXG4iLCBGb3JtYXRNb25leShuTW9uZXlTdXBwbHkpLmNfc3RyKCks
CiAgICAgICAgICAgICAgICAgRm9ybWF0TW9uZXkobU5vZGVDb2lucykuY19zdHIo
KSk7CiAKLSAgICAgICAgaWYgKG1Ob2RlQ29pbnMgPT0gMCkgewotICAgICAgICAg
ICAgcmV0ID0gMDsKLQl9Ci0JcmV0ID0gYmxvY2tWYWx1ZSAqIC43OworLy8gICAg
ICAgIGlmIChtTm9kZUNvaW5zID09IDApIHsKKy8vICAgICAgICAgICAgcmV0ID0g
MDsKKy8vICAgICAgICB9CiAKLSAgICB9CisgICAgICAgIHJldCA9IHN0YXRpY19j
YXN0PGludDY0X3Q+KGJsb2NrVmFsdWUgKiAuNyk7CisKKy8vICAgIH0KIAogICAg
IHJldHVybiByZXQ7CiB9CkBAIC0yMjgzLDEyICsyMjg0LDE3IEBAIGJvb2wgQ29u
bmVjdEJsb2NrKGNvbnN0IENCbG9jayYgYmxvY2ssIENWYWxpZGF0aW9uU3RhdGUm
IHN0YXRlLCBDQmxvY2tJbmRleCogcGluCiAgICAgaWYgKGJsb2NrLklzUHJvb2ZP
ZldvcmsoKSkKICAgICAgICAgbkV4cGVjdGVkTWludCArPSBuRmVlczsKIAotICAg
IGlmIChwaW5kZXgtPm5IZWlnaHQgPj0gNzI4OTAgJiYgc3RkOjp0aW1lKG51bGxw
dHIpID49IDE1MDY2MTA4MDAgJiYKKyAgICBpZiAoUGFyYW1zKCkuTmV0d29ya0lE
KCkgPT0gQ0Jhc2VDaGFpblBhcmFtczo6TUFJTiAmJiBwaW5kZXgtPm5IZWlnaHQg
Pj0gNzI4OTAgJiYgc3RkOjp0aW1lKG51bGxwdHIpID49IDE1MDY2MTA4MDAgJiYK
ICAgICAgICAgIUlzQmxvY2tWYWx1ZVZhbGlkKGJsb2NrLCBuRXhwZWN0ZWRNaW50
LCBwaW5kZXgtPm5NaW50KSkgewogICAgICAgICAgICAgcmV0dXJuIHN0YXRlLkRv
UygxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKCJDb25u
ZWN0QmxvY2soKSA6IHJld2FyZCBwYXlzIHRvbyBtdWNoIChhY3R1YWw9JXMgdnMg
bGltaXQ9JXMpIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Rm9ybWF0TW9uZXkocGluZGV4LT5uTWludCksIEZvcm1hdE1vbmV5KG5FeHBlY3Rl
ZE1pbnQpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUkVKRUNUX0lO
VkFMSUQsICJiYWQtY2ItYW1vdW50Iik7CisgICAgfSBlbHNlIGlmIChQYXJhbXMo
KS5OZXR3b3JrSUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpURVNUTkVUICYmIHBp
bmRleC0+bkhlaWdodCA+IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkgJiYgIUlz
QmxvY2tWYWx1ZVZhbGlkKGJsb2NrLCBuRXhwZWN0ZWRNaW50LCBwaW5kZXgtPm5N
aW50KSkgeworICAgICAgICByZXR1cm4gc3RhdGUuRG9TKDEwMCwKKyAgICAgICAg
ICAgICAgICAgICAgICAgICBlcnJvcigiQ29ubmVjdEJsb2NrKCkgOiByZXdhcmQg
cGF5cyB0b28gbXVjaCAoYWN0dWFsPSVzIHZzIGxpbWl0PSVzKSIsCisgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgRm9ybWF0TW9uZXkocGluZGV4LT5uTWlu
dCksIEZvcm1hdE1vbmV5KG5FeHBlY3RlZE1pbnQpKSwKKyAgICAgICAgICAgICAg
ICAgICAgICAgICBSRUpFQ1RfSU5WQUxJRCwgImJhZC1jYi1hbW91bnQiKTsKICAg
ICB9CiAKICAgICBpZiAoIWNvbnRyb2wuV2FpdCgpKQpkaWZmIC0tZ2l0IGEvc3Jj
L21pbmVyLmNwcCBiL3NyYy9taW5lci5jcHAKaW5kZXggODFmY2E4MDRlLi4zYmZm
NGZmY2IgMTAwNjQ0Ci0tLSBhL3NyYy9taW5lci5jcHAKKysrIGIvc3JjL21pbmVy
LmNwcApAQCAtMzMyLDEyICszMzIsMTkgQEAgQ0Jsb2NrVGVtcGxhdGUqIENyZWF0
ZU5ld0Jsb2NrKGNvbnN0IENTY3JpcHQmIHNjcmlwdFB1YktleUluLCBDV2FsbGV0
KiBwd2FsbGV0LAogICAgICAgICB9CiAKICAgICAgICAgaWYgKCFmUHJvb2ZPZlN0
YWtlKSB7Ci0gICAgICAgICAgICAvL1NlcnZpY2Vub2RlIGFuZCBnZW5lcmFsIGJ1
ZGdldCBwYXltZW50cwotICAgICAgICAgICAgRmlsbEJsb2NrUGF5ZWUodHhOZXcs
IG5GZWVzLCBmUHJvb2ZPZlN0YWtlKTsKLQotICAgICAgICAgICAgLy9NYWtlIHBh
eWVlCi0gICAgICAgICAgICBpZiAodHhOZXcudm91dC5zaXplKCkgPiAxKSB7Ci0g
ICAgICAgICAgICAgICAgcGJsb2NrLT5wYXllZSA9IHR4TmV3LnZvdXRbMV0uc2Ny
aXB0UHViS2V5OworICAgICAgICAgICAgaWYgKGNoYWluQWN0aXZlLkhlaWdodCgp
ID4gUGFyYW1zKCkuTEFTVF9QT1dfQkxPQ0soKSkgeworICAgICAgICAgICAgICAg
IEZpbGxCbG9ja1BheWVlKHR4TmV3LCBuRmVlcywgZlByb29mT2ZTdGFrZSk7Cisg
ICAgICAgICAgICAgICAgLy9NYWtlIHBheWVlCisgICAgICAgICAgICAgICAgaWYg
KHR4TmV3LnZvdXQuc2l6ZSgpID4gMSkgeworICAgICAgICAgICAgICAgICAgICBw
YmxvY2stPnBheWVlID0gdHhOZXcudm91dFsxXS5zY3JpcHRQdWJLZXk7CisgICAg
ICAgICAgICAgICAgfQorICAgICAgICAgICAgfQorICAgICAgICAgICAgLy8gUE9X
IHBoYXNlCisgICAgICAgICAgICBlbHNlIHsKKyAgICAgICAgICAgICAgICB0eE5l
dy52b3V0LnJlc2l6ZSgxKTsKKyAgICAgICAgICAgICAgICB0eE5ldy52b3V0WzBd
LnNjcmlwdFB1YktleSA9IHNjcmlwdFB1YktleUluOworICAgICAgICAgICAgICAg
IHR4TmV3LnZvdXRbMF0ublZhbHVlID0gMTAwMDAgKiBDT0lOOworICAgICAgICAg
ICAgICAgIHBibG9jay0+cGF5ZWUgPSBzY3JpcHRQdWJLZXlJbjsKICAgICAgICAg
ICAgIH0KICAgICAgICAgfQogCkBAIC00MDMsNiArNDEwLDEzIEBAIENCbG9ja1Rl
bXBsYXRlKiBDcmVhdGVOZXdCbG9ja1dpdGhLZXkoQ1Jlc2VydmVLZXkmIHJlc2Vy
dmVrZXksIENXYWxsZXQqIHB3YWxsZXQsCiAgICAgaWYgKCFyZXNlcnZla2V5Lkdl
dFJlc2VydmVkS2V5KHB1YmtleSkpCiAgICAgICAgIHJldHVybiBOVUxMOwogCisg
ICAgLy8gUG9XIHRlc3QgYWRkcmVzcworICAgIGlmIChQYXJhbXMoKS5OZXR3b3Jr
SUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpURVNUTkVUICYmIGNoYWluQWN0aXZl
LkhlaWdodCgpIDw9IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkpIHsKKyAgICAg
ICAgQ0JpdGNvaW5BZGRyZXNzIGFkZHJlc3MoInk1ekJkOG9MUVNuVGpDaFRVQ2ZS
aWVUQXA1WjMxYlJ3RVYiKTsKKyAgICAgICAgQ1NjcmlwdCBkZXN0ID0gR2V0U2Ny
aXB0Rm9yRGVzdGluYXRpb24oYWRkcmVzcy5HZXQoKSk7CisgICAgICAgIHJldHVy
biBDcmVhdGVOZXdCbG9jayhkZXN0LCBwd2FsbGV0LCBmUHJvb2ZPZlN0YWtlKTsK
KyAgICB9CisKICAgICBDU2NyaXB0IHNjcmlwdFB1YktleSA9IENTY3JpcHQoKSA8
PCBUb0J5dGVWZWN0b3IocHVia2V5KSA8PCBPUF9DSEVDS1NJRzsKICAgICByZXR1
cm4gQ3JlYXRlTmV3QmxvY2soc2NyaXB0UHViS2V5LCBwd2FsbGV0LCBmUHJvb2ZP
ZlN0YWtlKTsKIH0KQEAgLTQ2Miw3ICs0NzYsNyBAQCB2b2lkIEJpdGNvaW5NaW5l
cihDV2FsbGV0KiBwd2FsbGV0LCBib29sIGZQcm9vZk9mU3Rha2UpCiAKICAgICB3
aGlsZSAoZkdlbmVyYXRlQml0Y29pbnMgfHwgZlByb29mT2ZTdGFrZSkgewogICAg
ICAgICBpZiAoZlByb29mT2ZTdGFrZSkgewotICAgICAgICAgICAgaWYgKGNoYWlu
QWN0aXZlLlRpcCgpLT5uSGVpZ2h0IDwgUGFyYW1zKCkuTEFTVF9QT1dfQkxPQ0so
KSkgeworICAgICAgICAgICAgaWYgKGNoYWluQWN0aXZlLlRpcCgpLT5uSGVpZ2h0
IDw9IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkpIHsKICAgICAgICAgICAgICAg
ICBNaWxsaVNsZWVwKDUwMDApOwogICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog
ICAgICAgICAgICAgfQpkaWZmIC0tZ2l0IGEvc3JjL3NlcnZpY2Vub2RlLXN5bmMu
Y3BwIGIvc3JjL3NlcnZpY2Vub2RlLXN5bmMuY3BwCmluZGV4IDMwNjY1OTVlNi4u
MWU5ZTk4MjUwIDEwMDY0NAotLS0gYS9zcmMvc2VydmljZW5vZGUtc3luYy5jcHAK
KysrIGIvc3JjL3NlcnZpY2Vub2RlLXN5bmMuY3BwCkBAIC0yNjUsNyArMjY1LDcg
QEAgdm9pZCBDU2VydmljZW5vZGVTeW5jOjpQcm9jZXNzKCkKICAgICBpZiAoIWxv
Y2tSZWN2KSByZXR1cm47CiAKICAgICBCT09TVF9GT1JFQUNIIChDTm9kZSogcG5v
ZGUsIHZOb2RlcykgewotICAgICAgICBpZiAoUGFyYW1zKCkuTmV0d29ya0lEKCkg
PT0gQ0Jhc2VDaGFpblBhcmFtczo6UkVHVEVTVCkgeworICAgICAgICBpZiAoUGFy
YW1zKCkuTmV0d29ya0lEKCkgPT0gQ0Jhc2VDaGFpblBhcmFtczo6UkVHVEVTVCB8
fCBQYXJhbXMoKS5OZXR3b3JrSUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpURVNU
TkVUKSB7CiAgICAgICAgICAgICBpZiAoUmVxdWVzdGVkU2VydmljZW5vZGVBdHRl
bXB0IDw9IDIpIHsKICAgICAgICAgICAgICAgICBwbm9kZS0+UHVzaE1lc3NhZ2Uo
ImdldHNwb3JrcyIpOyAvL2dldCBjdXJyZW50IG5ldHdvcmsgc3BvcmtzCiAgICAg
ICAgICAgICB9IGVsc2UgaWYgKFJlcXVlc3RlZFNlcnZpY2Vub2RlQXR0ZW1wdCA8
IDQpIHsKZGlmZiAtLWdpdCBhL3NyYy94YnJpZGdlL3V0aWwvbG9nZ2VyLmNwcCBi
L3NyYy94YnJpZGdlL3V0aWwvbG9nZ2VyLmNwcAppbmRleCAxYzcxNGI2ZjAuLmQx
YjlmM2NmNyAxMDA2NDQKLS0tIGEvc3JjL3hicmlkZ2UvdXRpbC9sb2dnZXIuY3Bw
CisrKyBiL3NyYy94YnJpZGdlL3V0aWwvbG9nZ2VyLmNwcApAQCAtMTAsNiArMTAs
NyBAQAogI2luY2x1ZGUgPHN0cmluZz4KICNpbmNsdWRlIDxzc3RyZWFtPgogI2lu
Y2x1ZGUgPGZzdHJlYW0+CisjaW5jbHVkZSA8Y3RpbWU+CiAjaW5jbHVkZSA8Ym9v
c3QvdGhyZWFkL3RocmVhZC5ocHA+CiAjaW5jbHVkZSA8Ym9vc3QvdGhyZWFkL211
dGV4LmhwcD4KICNpbmNsdWRlIDxib29zdC90aHJlYWQvbG9ja3MuaHBwPgpAQCAt
OTMsOSArOTQsMTYgQEAgc3RkOjpzdHJpbmcgTE9HOjptYWtlRmlsZU5hbWUoKQog
ewogICAgIGJvb3N0OjpmaWxlc3lzdGVtOjpwYXRoIGRpcmVjdG9yeSA9IEdldERh
dGFEaXIoZmFsc2UpIC8gImxvZyI7CiAgICAgYm9vc3Q6OmZpbGVzeXN0ZW06OmNy
ZWF0ZV9kaXJlY3RvcnkoZGlyZWN0b3J5KTsKKyAgICAKKyAgICAvLyBJU08gODYw
MSBzaXplCisgICAgdW5zaWduZWQgbG9uZyBpc29TaXplID0gc2l6ZW9mICJZWVlZ
LU1NLUREVEhIOm1tOnNzWiI7CisgICAgY2hhciBpc29DU3RyW2lzb1NpemVdOwor
ICAgIAorICAgIHN0ZDo6dGltZV90IG5vdyA9IHN0ZDo6dGltZShOVUxMKTsKKyAg
ICBzdGQ6OnRtICpsb2NhbCA9IHN0ZDo6bG9jYWx0aW1lKCZub3cpOworICAgIHN0
ZDo6c3RyZnRpbWUoaXNvQ1N0ciwgaXNvU2l6ZSwgIiVGVCVUWiIsIGxvY2FsKTsK
KyAgICBzdGQ6OmJhc2ljX3N0cmluZzxjaGFyPiBkYXRlU3RyKGlzb0NTdHIpOwog
CiAgICAgcmV0dXJuIGRpcmVjdG9yeS5zdHJpbmcoKSArICIvIiArCi0gICAgICAg
ICAgICAieGJyaWRnZXAycF8iICsKLSAgICAgICAgICAgIGJvb3N0Ojpwb3NpeF90
aW1lOjp0b19pc29fc3RyaW5nKGJvb3N0Ojpwb3NpeF90aW1lOjpzZWNvbmRfY2xv
Y2s6OmxvY2FsX3RpbWUoKSkgKwotICAgICAgICAgICAgIi5sb2ciOworICAgICAg
ICAgICAgInhicmlkZ2VwMnBfIiArIGRhdGVTdHIgKyAiLmxvZyI7CiB9CmRpZmYg
LS1naXQgYS9zcmMveGJyaWRnZS91dGlsL3R4bG9nLmNwcCBiL3NyYy94YnJpZGdl
L3V0aWwvdHhsb2cuY3BwCmluZGV4IDdlYjczOTAwNi4uMDMzMzQwYThhIDEwMDY0
NAotLS0gYS9zcmMveGJyaWRnZS91dGlsL3R4bG9nLmNwcAorKysgYi9zcmMveGJy
aWRnZS91dGlsL3R4bG9nLmNwcApAQCAtMTAsNiArMTAsNyBAQAogI2luY2x1ZGUg
PHN0cmluZz4KICNpbmNsdWRlIDxzc3RyZWFtPgogI2luY2x1ZGUgPGZzdHJlYW0+
CisjaW5jbHVkZSA8Y3RpbWU+CiAjaW5jbHVkZSA8Ym9vc3QvZGF0ZV90aW1lL2dy
ZWdvcmlhbi9ncmVnb3JpYW4uaHBwPgogI2luY2x1ZGUgPGJvb3N0L2RhdGVfdGlt
ZS9wb3NpeF90aW1lL3Bvc2l4X3RpbWUuaHBwPgogI2luY2x1ZGUgPGJvb3N0L3Ro
cmVhZC90aHJlYWQuaHBwPgpAQCAtODksOCArOTAsMTcgQEAgc3RkOjpzdHJpbmcg
VFhMT0c6Om1ha2VGaWxlTmFtZSgpCiAgICAgYm9vc3Q6OmZpbGVzeXN0ZW06OnBh
dGggZGlyZWN0b3J5ID0gR2V0RGF0YURpcihmYWxzZSkgLyAibG9nLXR4IjsKICAg
ICBib29zdDo6ZmlsZXN5c3RlbTo6Y3JlYXRlX2RpcmVjdG9yeShkaXJlY3Rvcnkp
OwogCisgICAgLy8gSVNPIDg2MDEgc2l6ZQorICAgIHVuc2lnbmVkIGxvbmcgaXNv
U2l6ZSA9IHNpemVvZiAiWVlZWS1NTS1ERFRISDptbTpzc1oiOworICAgIGNoYXIg
aXNvQ1N0cltpc29TaXplXTsKKworICAgIHN0ZDo6dGltZV90IG5vdyA9IHN0ZDo6
dGltZShOVUxMKTsKKyAgICBzdGQ6OnRtICpsb2NhbCA9IHN0ZDo6bG9jYWx0aW1l
KCZub3cpOworICAgIHN0ZDo6c3RyZnRpbWUoaXNvQ1N0ciwgaXNvU2l6ZSwgIiVG
VCVUWiIsIGxvY2FsKTsKKyAgICBzdGQ6OmJhc2ljX3N0cmluZzxjaGFyPiBkYXRl
U3RyKGlzb0NTdHIpOworCiAgICAgcmV0dXJuIGRpcmVjdG9yeS5zdHJpbmcoKSAr
ICIvIiArCiAgICAgICAgICAgICAieGJyaWRnZXAycF8iICsKLSAgICAgICAgICAg
IGJvb3N0Ojpwb3NpeF90aW1lOjp0b19pc29fc3RyaW5nKGJvb3N0Ojpwb3NpeF90
aW1lOjpzZWNvbmRfY2xvY2s6OmxvY2FsX3RpbWUoKSkgKworICAgICAgICAgICAg
ZGF0ZVN0ciArCiAgICAgICAgICAgICAiLmxvZyI7CiB9Cg==`
	result, err := base64.StdEncoding.DecodeString(patch)
	if err != nil {
		logrus.Error("Failed to decode patch:", err)
	}
	return string(result)
}
