// Copyright Â© 2017 The Blocknet Developers
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package chain

import (
	"encoding/base64"

	"github.com/sirupsen/logrus"
)

const GenesisPatchFile = "dxregress.patch"

// GenesisPatchV1 contains the patch for enabling the new test environment blockchain.
func GenesisPatchV1() string {
	patch := `ZGlmZiAtLWdpdCBhL3NyYy9jaGFpbnBhcmFtcy5jcHAgYi9zcmMvY2hhaW5wYXJh
bXMuY3BwCmluZGV4IGY0NGJkMmU4Yi4uNzYyNDZhNzg0IDEwMDY0NAotLS0gYS9z
cmMvY2hhaW5wYXJhbXMuY3BwCisrKyBiL3NyYy9jaGFpbnBhcmFtcy5jcHAKQEAg
LTE5NCwzMiArMTk0LDMyIEBAIHB1YmxpYzoKICAgICAgICAgcGNoTWVzc2FnZVN0
YXJ0WzFdID0gMHg3NjsKICAgICAgICAgcGNoTWVzc2FnZVN0YXJ0WzJdID0gMHg2
NTsKICAgICAgICAgcGNoTWVzc2FnZVN0YXJ0WzNdID0gMHhiYTsKLSAgICAgICAg
dkFsZXJ0UHViS2V5ID0gUGFyc2VIZXgoIjAwMDAxMGU4M2IyNzAzY2NmMzIyZjdk
YmQ2MmRkNTg1NWFjN2MxMGJkMDU1ODE0Y2UxMjFiYTMyNjA3ZDU3M2I4ODEwYzAy
YzA1ODJhZWQwNWI0ZGViOWM0Yjc3YjI2ZDkyNDI4YzYxMjU2Y2Q0Mjc3NGJhYmVh
MGEwNzNiMmVkMGM5Iik7Ci0gICAgICAgIG5EZWZhdWx0UG9ydCA9IDQxNDc0Owor
Ly8gICAgICAgIHZBbGVydFB1YktleSA9IFBhcnNlSGV4KCIwMDAwMTBlODNiMjcw
M2NjZjMyMmY3ZGJkNjJkZDU4NTVhYzdjMTBiZDA1NTgxNGNlMTIxYmEzMjYwN2Q1
NzNiODgxMGMwMmMwNTgyYWVkMDViNGRlYjljNGI3N2IyNmQ5MjQyOGM2MTI1NmNk
NDI3NzRiYWJlYTBhMDczYjJlZDBjOSIpOworICAgICAgICBuRGVmYXVsdFBvcnQg
PSA0MTQ3NjsKICAgICAgICAgbkVuZm9yY2VCbG9ja1VwZ3JhZGVNYWpvcml0eSA9
IDUxOwogICAgICAgICBuUmVqZWN0QmxvY2tPdXRkYXRlZE1ham9yaXR5ID0gNzU7
CiAgICAgICAgIG5Ub0NoZWNrQmxvY2tVcGdyYWRlTWFqb3JpdHkgPSAxMDA7CiAg
ICAgICAgIG5NaW5lclRocmVhZHMgPSAwOwotICAgICAgICBuVGFyZ2V0VGltZXNw
YW4gPSAxICogNjA7IC8vIEJsb2NrbmV0RFg6IDEgZGF5Ci0gICAgICAgIG5UYXJn
ZXRTcGFjaW5nID0gMSAqIDYwOyAgLy8gQmxvY2tuZXREWDogMSBtaW51dGUKLSAg
ICAgICAgbkxhc3RQT1dCbG9jayA9IDIwMDA7Ci0gICAgICAgIG5NYXR1cml0eSA9
IDE1OwotICAgICAgICBuTW9kaWZpZXJVcGRhdGVCbG9jayA9IDUxMTk3OyAvL2Fw
cHJveCBNb24sIDE3IEFwciAyMDE3IDA0OjAwOjAwIEdNVAorICAgICAgICBuVGFy
Z2V0VGltZXNwYW4gPSA2MDsgLy8gQmxvY2tuZXREWDogMSBtaW51dGUKKyAgICAg
ICAgblRhcmdldFNwYWNpbmcgPSAzMDsgIC8vIEJsb2NrbmV0RFg6IDMwIHNlY29u
ZHMKKyAgICAgICAgbkxhc3RQT1dCbG9jayA9IDUwOworICAgICAgICBuTWF0dXJp
dHkgPSAxMDsKKyAgICAgICAgbk1vZGlmaWVyVXBkYXRlQmxvY2sgPSAyXjMyOwog
CiAgICAgICAgIC8vISBNb2RpZnkgdGhlIHRlc3RuZXQgZ2VuZXNpcyBibG9jayBz
byB0aGUgdGltZXN0YW1wIGlzIHZhbGlkIGZvciBhIGxhdGVyIHN0YXJ0LgotICAg
ICAgICBnZW5lc2lzLm5UaW1lID0gMTUwMzU3MTAwMDsKLSAgICAgICAgZ2VuZXNp
cy5uTm9uY2UgPSAyMTU4OTYyOworICAgICAgICBiblByb29mT2ZXb3JrTGltaXQg
PSB+dWludDI1NigpID4+IDE7CisgICAgICAgIGdlbmVzaXMublRpbWUgPSAxNTA5
MTYzMDY3OworICAgICAgICBnZW5lc2lzLm5Ob25jZSA9IDEyMzQ1Njc7CiAKICAg
ICAgICAgaGFzaEdlbmVzaXNCbG9jayA9IGdlbmVzaXMuR2V0SGFzaCgpOwotICAg
ICAgICBhc3NlcnQoaGFzaEdlbmVzaXNCbG9jayA9PSB1aW50MjU2KCIweDAwMDAw
ZjkwYWMyNjA4NTllNDUxNTM1NjcxOWQ5NGM5ZmI4Y2FkYjFhM2RkYTE4NmE2NGFj
NDFjZTRjM2M3YTciKSk7CisgICAgICAgIGFzc2VydChoYXNoR2VuZXNpc0Jsb2Nr
ID09IHVpbnQyNTYoIjY5YWYwMzliZjZhOWVkMzdmNTcxNzkyNTkwZGVkZGMwZWYy
ZDQ4YmU3MDg0OTljODk5ODBiMWNiMzljNDQxYjEiKSk7CiAKICAgICAgICAgdkZp
eGVkU2VlZHMuY2xlYXIoKTsKICAgICAgICAgdlNlZWRzLmNsZWFyKCk7Ci0JCi0J
Ci0gICAgICAgIHZTZWVkcy5wdXNoX2JhY2soQ0ROU1NlZWREYXRhKCIxNzguNjIu
OTAuMjEzIiwgIjE3OC42Mi45MC4yMTMiKSk7IC8vIHNlZWQgbm9kZQotICAgICAg
ICB2U2VlZHMucHVzaF9iYWNrKENETlNTZWVkRGF0YSgiMTM4LjE5Ny43My4yMTQi
LCAiMTM4LjE5Ny43My4yMTQiKSk7IC8vIHNlZWQgbm9kZQotICAgICAgICB2U2Vl
ZHMucHVzaF9iYWNrKENETlNTZWVkRGF0YSgiMzQuMjM1LjQ5LjI0OCIsICIzNC4y
MzUuNDkuMjQ4IikpOyAvLyBzZWVkIG5vZGUKKworLy8gICAgICAgIHZTZWVkcy5w
dXNoX2JhY2soQ0ROU1NlZWREYXRhKCIxNzguNjIuOTAuMjEzIiwgIjE3OC42Mi45
MC4yMTMiKSk7IC8vIHNlZWQgbm9kZQorLy8gICAgICAgIHZTZWVkcy5wdXNoX2Jh
Y2soQ0ROU1NlZWREYXRhKCIxMzguMTk3LjczLjIxNCIsICIxMzguMTk3LjczLjIx
NCIpKTsgLy8gc2VlZCBub2RlCisvLyAgICAgICAgdlNlZWRzLnB1c2hfYmFjayhD
RE5TU2VlZERhdGEoIjM0LjIzNS40OS4yNDgiLCAiMzQuMjM1LjQ5LjI0OCIpKTsg
Ly8gc2VlZCBub2RlCiAKICAgICAgICAgYmFzZTU4UHJlZml4ZXNbUFVCS0VZX0FE
RFJFU1NdID0gc3RkOjp2ZWN0b3I8dW5zaWduZWQgY2hhcj4oMSwgMTM5KTsgLy8g
VGVzdG5ldCBibG9ja25ldGR4IGFkZHJlc3NlcyBzdGFydCB3aXRoICd4JyBvciAn
eScKICAgICAgICAgYmFzZTU4UHJlZml4ZXNbU0NSSVBUX0FERFJFU1NdID0gc3Rk
Ojp2ZWN0b3I8dW5zaWduZWQgY2hhcj4oMSwgMTkpOyAgLy8gVGVzdG5ldCBibG9j
a25ldGR4IHNjcmlwdCBhZGRyZXNzZXMgc3RhcnQgd2l0aCAnOCcgb3IgJzknCkBA
IC0yMzEsMTggKzIzMSwyMCBAQCBwdWJsaWM6CiAgICAgICAgIC8vIFRlc3RuZXQg
YmxvY2tuZXRkeCBCSVA0NCBjb2luIHR5cGUgaXMgJzEnIChBbGwgY29pbidzIHRl
c3RuZXQgZGVmYXVsdCkKICAgICAgICAgYmFzZTU4UHJlZml4ZXNbRVhUX0NPSU5f
VFlQRV0gPSBib29zdDo6YXNzaWduOjpsaXN0X29mKDB4ODApKDB4MDApKDB4MDAp
KDB4MDEpLmNvbnZlcnRfdG9fY29udGFpbmVyPHN0ZDo6dmVjdG9yPHVuc2lnbmVk
IGNoYXI+ID4oKTsKIAotICAgICAgICBjb252ZXJ0U2VlZDYodkZpeGVkU2VlZHMs
IHBuU2VlZDZfdGVzdCwgQVJSQVlMRU4ocG5TZWVkNl90ZXN0KSk7CisvLyAgICAg
ICAgY29udmVydFNlZWQ2KHZGaXhlZFNlZWRzLCBwblNlZWQ2X3Rlc3QsIEFSUkFZ
TEVOKHBuU2VlZDZfdGVzdCkpOwogCiAgICAgICAgIGZSZXF1aXJlUlBDUGFzc3dv
cmQgPSB0cnVlOwotICAgICAgICBmTWluaW5nUmVxdWlyZXNQZWVycyA9IHRydWU7
Ci0gICAgICAgIGZBbGxvd01pbkRpZmZpY3VsdHlCbG9ja3MgPSB0cnVlOworICAg
ICAgICBmTWluaW5nUmVxdWlyZXNQZWVycyA9IGZhbHNlOworICAgICAgICBmQWxs
b3dNaW5EaWZmaWN1bHR5QmxvY2tzID0gZmFsc2U7CiAgICAgICAgIGZEZWZhdWx0
Q29uc2lzdGVuY3lDaGVja3MgPSBmYWxzZTsKLSAgICAgICAgZlJlcXVpcmVTdGFu
ZGFyZCA9IGZhbHNlOwotICAgICAgICBmTWluZUJsb2Nrc09uRGVtYW5kID0gZmFs
c2U7Ci0gICAgICAgIGZUZXN0bmV0VG9CZURlcHJlY2F0ZWRGaWVsZFJQQyA9IHRy
dWU7CisgICAgICAgIGZSZXF1aXJlU3RhbmRhcmQgPSB0cnVlOworICAgICAgICBm
TWluZUJsb2Nrc09uRGVtYW5kID0gdHJ1ZTsKKyAgICAgICAgZlNraXBQcm9vZk9m
V29ya0NoZWNrID0gdHJ1ZTsKKyAgICAgICAgZlRlc3RuZXRUb0JlRGVwcmVjYXRl
ZEZpZWxkUlBDID0gZmFsc2U7CisgICAgICAgIGZIZWFkZXJzRmlyc3RTeW5jaW5n
QWN0aXZlID0gZmFsc2U7CiAKICAgICAgICAgblBvb2xNYXhUcmFuc2FjdGlvbnMg
PSAyOwotICAgICAgICBzdHJTcG9ya0tleSA9ICIwNDU2NWY0MjliOGM2OGRhYmRj
ZGYwOTYwOGJlMDViNGExMGZjNzA0ZjdkZTE4NjZhYWVlZDI4YTcyOWVjNWI4YzQx
OGQ5MGY5NTEwYmExMTVjMGYzNWYzNTNiMWFlYTk4M2ZlOTkzOTdkMWMyMDY4NWQ2
YWIzZWQwZDBiN2JhM2VhIjsKKyAgICAgICAgc3RyU3BvcmtLZXkgPSAiMDQ2YWU3
ZGU3YzhmNmJiMmU2YmNiYzFkYmRiNzFjYzQzNDFlYzRiNGVjOWYxZDdhMTZiNmJj
YzYxYzQ2MGQ1NDIxYWZlMWIwNDg3YWNjYzQ2ZjJlZTAwNDQ5Mjc3ZjliMjE2MWU1
ZTUxZWJmYjA4YTNjNTM2MWI4MTFlYTIyZDNiOSI7CiAgICAgICAgIHN0ck9iZnVz
Y2F0aW9uUG9vbER1bW15QWRkcmVzcyA9ICJ5NTdjcWZHUmtla1J5RFJOZUppTHRZ
VkVidmhYck5ibW94IjsKICAgICAgICAgblN0YXJ0U2VydmljZW5vZGVQYXltZW50
cyA9IDE0MjA4Mzc1NTg7IC8vRnJpLCAwOSBKYW4gMjAxNSAyMTowNTo1OCBHTVQK
ICAgICB9CmRpZmYgLS1naXQgYS9zcmMvaW5pdC5jcHAgYi9zcmMvaW5pdC5jcHAK
aW5kZXggMjViOWNlNzNlLi4wMGJlMDkwNzIgMTAwNjQ0Ci0tLSBhL3NyYy9pbml0
LmNwcAorKysgYi9zcmMvaW5pdC5jcHAKQEAgLTM1MSw3ICszNTEsNyBAQCBzdGQ6
OnN0cmluZyBIZWxwTWVzc2FnZShIZWxwTWVzc2FnZU1vZGUgbW9kZSkKICAgICBz
dHJVc2FnZSArPSBIZWxwTWVzc2FnZU9wdCgiLW9ubHluZXQ9PG5ldD4iLCBfKCJP
bmx5IGNvbm5lY3QgdG8gbm9kZXMgaW4gbmV0d29yayA8bmV0PiAoaXB2NCwgaXB2
NiBvciBvbmlvbikiKSk7CiAgICAgc3RyVXNhZ2UgKz0gSGVscE1lc3NhZ2VPcHQo
Ii1wZXJtaXRiYXJlbXVsdGlzaWciLCBzdHJwcmludGYoXygiUmVsYXkgbm9uLVAy
U0ggbXVsdGlzaWcgKGRlZmF1bHQ6ICV1KSIpLCAxKSk7CiAgICAgc3RyVXNhZ2Ug
Kz0gSGVscE1lc3NhZ2VPcHQoIi1wZWVyYmxvb21maWx0ZXJzIiwgc3RycHJpbnRm
KF8oIlN1cHBvcnQgZmlsdGVyaW5nIG9mIGJsb2NrcyBhbmQgdHJhbnNhY3Rpb24g
d2l0aCBibG9vbSBmaWx0ZXJzIChkZWZhdWx0OiAldSkiKSwgZmFsc2UpKTsKLSAg
ICBzdHJVc2FnZSArPSBIZWxwTWVzc2FnZU9wdCgiLXBvcnQ9PHBvcnQ+Iiwgc3Ry
cHJpbnRmKF8oIkxpc3RlbiBmb3IgY29ubmVjdGlvbnMgb24gPHBvcnQ+IChkZWZh
dWx0OiAldSBvciB0ZXN0bmV0OiAldSkiKSwgNDE0MTIsIDQxNDc0KSk7CisgICAg
c3RyVXNhZ2UgKz0gSGVscE1lc3NhZ2VPcHQoIi1wb3J0PTxwb3J0PiIsIHN0cnBy
aW50ZihfKCJMaXN0ZW4gZm9yIGNvbm5lY3Rpb25zIG9uIDxwb3J0PiAoZGVmYXVs
dDogJXUgb3IgdGVzdG5ldDogJXUpIiksIDQxNDEyLCA0MTQ3NikpOwogICAgIHN0
clVzYWdlICs9IEhlbHBNZXNzYWdlT3B0KCItcHJveHk9PGlwOnBvcnQ+IiwgXygi
Q29ubmVjdCB0aHJvdWdoIFNPQ0tTNSBwcm94eSIpKTsKICAgICBzdHJVc2FnZSAr
PSBIZWxwTWVzc2FnZU9wdCgiLXNlZWRub2RlPTxpcD4iLCBfKCJDb25uZWN0IHRv
IGEgbm9kZSB0byByZXRyaWV2ZSBwZWVyIGFkZHJlc3NlcywgYW5kIGRpc2Nvbm5l
Y3QiKSk7CiAgICAgc3RyVXNhZ2UgKz0gSGVscE1lc3NhZ2VPcHQoIi10aW1lb3V0
PTxuPiIsIHN0cnByaW50ZihfKCJTcGVjaWZ5IGNvbm5lY3Rpb24gdGltZW91dCBp
biBtaWxsaXNlY29uZHMgKG1pbmltdW06IDEsIGRlZmF1bHQ6ICVkKSIpLCBERUZB
VUxUX0NPTk5FQ1RfVElNRU9VVCkpOwpkaWZmIC0tZ2l0IGEvc3JjL2tlcm5lbC5j
cHAgYi9zcmMva2VybmVsLmNwcAppbmRleCBhMzc2YTg1NmIuLmU4NzdkMjQ5ZSAx
MDA2NDQKLS0tIGEvc3JjL2tlcm5lbC5jcHAKKysrIGIvc3JjL2tlcm5lbC5jcHAK
QEAgLTI1Niw2ICsyNTYsOCBAQCBib29sIEdldEtlcm5lbFN0YWtlTW9kaWZpZXIo
dWludDI1NiBoYXNoQmxvY2tGcm9tLCB1aW50NjRfdCYgblN0YWtlTW9kaWZpZXIs
IGludAogICAgIC8vIGxvb3AgdG8gZmluZCB0aGUgc3Rha2UgbW9kaWZpZXIgbGF0
ZXIgYnkgYSBzZWxlY3Rpb24gaW50ZXJ2YWwKICAgICB3aGlsZSAoblN0YWtlTW9k
aWZpZXJUaW1lIDwgcGluZGV4RnJvbS0+R2V0QmxvY2tUaW1lKCkgKyBuU3Rha2VN
b2RpZmllclNlbGVjdGlvbkludGVydmFsKSB7CiAgICAgICAgIGlmICghcGluZGV4
TmV4dCkgeworICAgICAgICAgICAgaWYgKFBhcmFtcygpLk5ldHdvcmtJRCgpID09
IENCYXNlQ2hhaW5QYXJhbXM6OlRFU1RORVQgJiYgcGluZGV4LT5uSGVpZ2h0ID49
IFBhcmFtcygpLkxBU1RfUE9XX0JMT0NLKCkpIC8vIGp1bXBzdGFydCBzdGFraW5n
CisgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAvLyBTaG91bGQg
bmV2ZXIgaGFwcGVuCiAgICAgICAgICAgICByZXR1cm4gZXJyb3IoIk51bGwgcGlu
ZGV4TmV4dFxuIik7CiAgICAgICAgIH0KZGlmZiAtLWdpdCBhL3NyYy9tYWluLmNw
cCBiL3NyYy9tYWluLmNwcAppbmRleCA0YmM2YmNmYWQuLjEyOWVmYThkMyAxMDA2
NDQKLS0tIGEvc3JjL21haW4uY3BwCisrKyBiL3NyYy9tYWluLmNwcApAQCAtNzMs
NyArNzMsNyBAQCB1bnNpZ25lZCBpbnQgbkNvaW5DYWNoZVNpemUgPSA1MDAwOwog
Ym9vbCBmQWxlcnRzID0gREVGQVVMVF9BTEVSVFM7CiBDb2luVmFsaWRhdG9yICZj
b2luVmFsaWRhdG9yID0gQ29pblZhbGlkYXRvcjo6aW5zdGFuY2UoKTsKIAotdW5z
aWduZWQgaW50IG5TdGFrZU1pbkFnZSA9IDYwICogNjA7Cit1bnNpZ25lZCBpbnQg
blN0YWtlTWluQWdlID0gMTU7IC8vIHNlY29uZHMKIGludDY0X3QgblJlc2VydmVC
YWxhbmNlID0gMDsKIAogLyoqIEZlZXMgc21hbGxlciB0aGFuIHRoaXMgKGluIGR1
ZmZzKSBhcmUgY29uc2lkZXJlZCB6ZXJvIGZlZSAoZm9yIHJlbGF5aW5nIGFuZCBt
aW5pbmcpCkBAIC0xNjU0LDEwICsxNjU0LDggQEAgaW50NjRfdCBHZXRCbG9ja1Zh
bHVlKGludCBuSGVpZ2h0KQogewogICAgIGludDY0X3QgblN1YnNpZHkgPSAwOwog
Ci0gICAgaWYgKFBhcmFtcygpLk5ldHdvcmtJRCgpID09IENCYXNlQ2hhaW5QYXJh
bXM6OlRFU1RORVQpIHsKLSAgICAgICAgaWYgKG5IZWlnaHQgPCAyMDAgJiYgbkhl
aWdodCA+IDApCi0gICAgICAgICAgICByZXR1cm4gMjUwMDAwICogQ09JTjsKLSAg
ICB9CisgICAgaWYgKFBhcmFtcygpLk5ldHdvcmtJRCgpID09IENCYXNlQ2hhaW5Q
YXJhbXM6OlRFU1RORVQpCisgICAgICAgIHJldHVybiAxICogQ09JTjsKIAogICAg
IC8vIFJlZHVjZSBSZXdhcmQgc3RhcnRpbmcgeWVhciAxCiAgICAgaWYgKG5IZWln
aHQgPT0gMCkgewpAQCAtMTY4NCwxMyArMTY4MiwxMyBAQCBpbnQ2NF90IEdldFNl
cnZpY2Vub2RlUGF5bWVudChpbnQgbkhlaWdodCwgaW50NjRfdCBibG9ja1ZhbHVl
LCBpbnQgblNlcnZpY2Vub2RlQwogICAgIGludDY0X3QgcmV0ID0gMDsKIAogICAg
IGlmIChQYXJhbXMoKS5OZXR3b3JrSUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpU
RVNUTkVUKSB7Ci0gICAgICAgIGlmIChuSGVpZ2h0IDwgMjAwKQorICAgICAgICBp
ZiAobkhlaWdodCA8PSBQYXJhbXMoKS5MQVNUX1BPV19CTE9DSygpKQogICAgICAg
ICAgICAgcmV0dXJuIDA7CiAgICAgfQogCi0gICAgaWYgKG5IZWlnaHQgPD0gMjY1
MCkgewotICAgICAgICByZXQgPSBibG9ja1ZhbHVlIC8gNTsKLSAgICB9IGVsc2Ug
aWYgKG5IZWlnaHQgPiAyNjUwKSB7CisvLyAgICBpZiAobkhlaWdodCA8PSAyNjUw
KSB7CisvLyAgICAgICAgcmV0ID0gYmxvY2tWYWx1ZSAvIDU7CisvLyAgICB9IGVs
c2UgaWYgKG5IZWlnaHQgPiAyNjUwKSB7CiAgICAgICAgIGludDY0X3Qgbk1vbmV5
U3VwcGx5ID0gY2hhaW5BY3RpdmUuVGlwKCktPm5Nb25leVN1cHBseTsKICAgICAg
ICAgaW50NjRfdCBtTm9kZUNvaW5zID0gbW5vZGVtYW4uc2l6ZSgpICogMTAwMDAg
KiBDT0lOOwogCkBAIC0xNzAyLDEyICsxNzAwLDEzIEBAIGludDY0X3QgR2V0U2Vy
dmljZW5vZGVQYXltZW50KGludCBuSGVpZ2h0LCBpbnQ2NF90IGJsb2NrVmFsdWUs
IGludCBuU2VydmljZW5vZGVDCiAgICAgICAgICAgICBMb2dQcmludGYoIkdldFNl
cnZpY2Vub2RlUGF5bWVudCgpOiBtb25leXN1cHBseT0lcywgbm9kZWNvaW5zPSVz
IFxuIiwgRm9ybWF0TW9uZXkobk1vbmV5U3VwcGx5KS5jX3N0cigpLAogICAgICAg
ICAgICAgICAgIEZvcm1hdE1vbmV5KG1Ob2RlQ29pbnMpLmNfc3RyKCkpOwogCi0g
ICAgICAgIGlmIChtTm9kZUNvaW5zID09IDApIHsKLSAgICAgICAgICAgIHJldCA9
IDA7Ci0JfQotCXJldCA9IGJsb2NrVmFsdWUgKiAuNzsKKy8vICAgICAgICBpZiAo
bU5vZGVDb2lucyA9PSAwKSB7CisvLyAgICAgICAgICAgIHJldCA9IDA7CisvLyAg
ICAgICAgfQorCisgICAgICAgIHJldCA9IHN0YXRpY19jYXN0PGludDY0X3Q+KGJs
b2NrVmFsdWUgKiAuNyk7CiAKLSAgICB9CisvLyAgICB9CiAKICAgICByZXR1cm4g
cmV0OwogfQpAQCAtMjI4MywxMiArMjI4MiwxNyBAQCBib29sIENvbm5lY3RCbG9j
ayhjb25zdCBDQmxvY2smIGJsb2NrLCBDVmFsaWRhdGlvblN0YXRlJiBzdGF0ZSwg
Q0Jsb2NrSW5kZXgqIHBpbgogICAgIGlmIChibG9jay5Jc1Byb29mT2ZXb3JrKCkp
CiAgICAgICAgIG5FeHBlY3RlZE1pbnQgKz0gbkZlZXM7CiAKLSAgICBpZiAocGlu
ZGV4LT5uSGVpZ2h0ID49IDcyODkwICYmIHN0ZDo6dGltZShudWxscHRyKSA+PSAx
NTA2NjEwODAwICYmCisgICAgaWYgKFBhcmFtcygpLk5ldHdvcmtJRCgpID09IENC
YXNlQ2hhaW5QYXJhbXM6Ok1BSU4gJiYgcGluZGV4LT5uSGVpZ2h0ID49IDcyODkw
ICYmIHN0ZDo6dGltZShudWxscHRyKSA+PSAxNTA2NjEwODAwICYmCiAgICAgICAg
ICFJc0Jsb2NrVmFsdWVWYWxpZChibG9jaywgbkV4cGVjdGVkTWludCwgcGluZGV4
LT5uTWludCkpIHsKICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5Eb1MoMTAwLAog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcigiQ29ubmVjdEJsb2Nr
KCkgOiByZXdhcmQgcGF5cyB0b28gbXVjaCAoYWN0dWFsPSVzIHZzIGxpbWl0PSVz
KSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1hdE1v
bmV5KHBpbmRleC0+bk1pbnQpLCBGb3JtYXRNb25leShuRXhwZWN0ZWRNaW50KSks
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJFSkVDVF9JTlZBTElELCAi
YmFkLWNiLWFtb3VudCIpOworICAgIH0gZWxzZSBpZiAoUGFyYW1zKCkuTmV0d29y
a0lEKCkgPT0gQ0Jhc2VDaGFpblBhcmFtczo6VEVTVE5FVCAmJiBwaW5kZXgtPm5I
ZWlnaHQgPiBQYXJhbXMoKS5MQVNUX1BPV19CTE9DSygpICYmICFJc0Jsb2NrVmFs
dWVWYWxpZChibG9jaywgbkV4cGVjdGVkTWludCwgcGluZGV4LT5uTWludCkpIHsK
KyAgICAgICAgcmV0dXJuIHN0YXRlLkRvUygxMDAsCisgICAgICAgICAgICAgICAg
ICAgICAgICAgZXJyb3IoIkNvbm5lY3RCbG9jaygpIDogcmV3YXJkIHBheXMgdG9v
IG11Y2ggKGFjdHVhbD0lcyB2cyBsaW1pdD0lcykiLAorICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEZvcm1hdE1vbmV5KHBpbmRleC0+bk1pbnQpLCBGb3Jt
YXRNb25leShuRXhwZWN0ZWRNaW50KSksCisgICAgICAgICAgICAgICAgICAgICAg
ICAgUkVKRUNUX0lOVkFMSUQsICJiYWQtY2ItYW1vdW50Iik7CiAgICAgfQogCiAg
ICAgaWYgKCFjb250cm9sLldhaXQoKSkKZGlmZiAtLWdpdCBhL3NyYy9taW5lci5j
cHAgYi9zcmMvbWluZXIuY3BwCmluZGV4IDgxZmNhODA0ZS4uMmNmMjYyYWMyIDEw
MDY0NAotLS0gYS9zcmMvbWluZXIuY3BwCisrKyBiL3NyYy9taW5lci5jcHAKQEAg
LTMzMiwxMiArMzMyLDE5IEBAIENCbG9ja1RlbXBsYXRlKiBDcmVhdGVOZXdCbG9j
ayhjb25zdCBDU2NyaXB0JiBzY3JpcHRQdWJLZXlJbiwgQ1dhbGxldCogcHdhbGxl
dCwKICAgICAgICAgfQogCiAgICAgICAgIGlmICghZlByb29mT2ZTdGFrZSkgewot
ICAgICAgICAgICAgLy9TZXJ2aWNlbm9kZSBhbmQgZ2VuZXJhbCBidWRnZXQgcGF5
bWVudHMKLSAgICAgICAgICAgIEZpbGxCbG9ja1BheWVlKHR4TmV3LCBuRmVlcywg
ZlByb29mT2ZTdGFrZSk7Ci0KLSAgICAgICAgICAgIC8vTWFrZSBwYXllZQotICAg
ICAgICAgICAgaWYgKHR4TmV3LnZvdXQuc2l6ZSgpID4gMSkgewotICAgICAgICAg
ICAgICAgIHBibG9jay0+cGF5ZWUgPSB0eE5ldy52b3V0WzFdLnNjcmlwdFB1Yktl
eTsKKyAgICAgICAgICAgIGlmIChjaGFpbkFjdGl2ZS5IZWlnaHQoKSA+IFBhcmFt
cygpLkxBU1RfUE9XX0JMT0NLKCkpIHsKKyAgICAgICAgICAgICAgICBGaWxsQmxv
Y2tQYXllZSh0eE5ldywgbkZlZXMsIGZQcm9vZk9mU3Rha2UpOworICAgICAgICAg
ICAgICAgIC8vTWFrZSBwYXllZQorICAgICAgICAgICAgICAgIGlmICh0eE5ldy52
b3V0LnNpemUoKSA+IDEpIHsKKyAgICAgICAgICAgICAgICAgICAgcGJsb2NrLT5w
YXllZSA9IHR4TmV3LnZvdXRbMV0uc2NyaXB0UHViS2V5OworICAgICAgICAgICAg
ICAgIH0KKyAgICAgICAgICAgIH0KKyAgICAgICAgICAgIC8vIFBPVyBwaGFzZQor
ICAgICAgICAgICAgZWxzZSB7CisgICAgICAgICAgICAgICAgdHhOZXcudm91dC5y
ZXNpemUoMSk7CisgICAgICAgICAgICAgICAgdHhOZXcudm91dFswXS5zY3JpcHRQ
dWJLZXkgPSBzY3JpcHRQdWJLZXlJbjsKKyAgICAgICAgICAgICAgICB0eE5ldy52
b3V0WzBdLm5WYWx1ZSA9IDEwMDAwICogQ09JTjsKKyAgICAgICAgICAgICAgICBw
YmxvY2stPnBheWVlID0gc2NyaXB0UHViS2V5SW47CiAgICAgICAgICAgICB9CiAg
ICAgICAgIH0KIApAQCAtNDAzLDYgKzQxMCwxMyBAQCBDQmxvY2tUZW1wbGF0ZSog
Q3JlYXRlTmV3QmxvY2tXaXRoS2V5KENSZXNlcnZlS2V5JiByZXNlcnZla2V5LCBD
V2FsbGV0KiBwd2FsbGV0LAogICAgIGlmICghcmVzZXJ2ZWtleS5HZXRSZXNlcnZl
ZEtleShwdWJrZXkpKQogICAgICAgICByZXR1cm4gTlVMTDsKIAorICAgIC8vIFBv
VyB0ZXN0IGFkZHJlc3MKKyAgICBpZiAoUGFyYW1zKCkuTmV0d29ya0lEKCkgPT0g
Q0Jhc2VDaGFpblBhcmFtczo6VEVTVE5FVCAmJiBjaGFpbkFjdGl2ZS5IZWlnaHQo
KSA8PSBQYXJhbXMoKS5MQVNUX1BPV19CTE9DSygpKSB7CisgICAgICAgIENCaXRj
b2luQWRkcmVzcyBhZGRyZXNzKCJ5NXpCZDhvTFFTblRqQ2hUVUNmUmllVEFwNVoz
MWJSd0VWIik7CisgICAgICAgIENTY3JpcHQgZGVzdCA9IEdldFNjcmlwdEZvckRl
c3RpbmF0aW9uKGFkZHJlc3MuR2V0KCkpOworICAgICAgICByZXR1cm4gQ3JlYXRl
TmV3QmxvY2soZGVzdCwgcHdhbGxldCwgZlByb29mT2ZTdGFrZSk7CisgICAgfQor
CiAgICAgQ1NjcmlwdCBzY3JpcHRQdWJLZXkgPSBDU2NyaXB0KCkgPDwgVG9CeXRl
VmVjdG9yKHB1YmtleSkgPDwgT1BfQ0hFQ0tTSUc7CiAgICAgcmV0dXJuIENyZWF0
ZU5ld0Jsb2NrKHNjcmlwdFB1YktleSwgcHdhbGxldCwgZlByb29mT2ZTdGFrZSk7
CiB9CmRpZmYgLS1naXQgYS9zcmMvc2VydmljZW5vZGUtc3luYy5jcHAgYi9zcmMv
c2VydmljZW5vZGUtc3luYy5jcHAKaW5kZXggMzA2NjU5NWU2Li4xZTllOTgyNTAg
MTAwNjQ0Ci0tLSBhL3NyYy9zZXJ2aWNlbm9kZS1zeW5jLmNwcAorKysgYi9zcmMv
c2VydmljZW5vZGUtc3luYy5jcHAKQEAgLTI2NSw3ICsyNjUsNyBAQCB2b2lkIENT
ZXJ2aWNlbm9kZVN5bmM6OlByb2Nlc3MoKQogICAgIGlmICghbG9ja1JlY3YpIHJl
dHVybjsKIAogICAgIEJPT1NUX0ZPUkVBQ0ggKENOb2RlKiBwbm9kZSwgdk5vZGVz
KSB7Ci0gICAgICAgIGlmIChQYXJhbXMoKS5OZXR3b3JrSUQoKSA9PSBDQmFzZUNo
YWluUGFyYW1zOjpSRUdURVNUKSB7CisgICAgICAgIGlmIChQYXJhbXMoKS5OZXR3
b3JrSUQoKSA9PSBDQmFzZUNoYWluUGFyYW1zOjpSRUdURVNUIHx8IFBhcmFtcygp
Lk5ldHdvcmtJRCgpID09IENCYXNlQ2hhaW5QYXJhbXM6OlRFU1RORVQpIHsKICAg
ICAgICAgICAgIGlmIChSZXF1ZXN0ZWRTZXJ2aWNlbm9kZUF0dGVtcHQgPD0gMikg
ewogICAgICAgICAgICAgICAgIHBub2RlLT5QdXNoTWVzc2FnZSgiZ2V0c3Bvcmtz
Iik7IC8vZ2V0IGN1cnJlbnQgbmV0d29yayBzcG9ya3MKICAgICAgICAgICAgIH0g
ZWxzZSBpZiAoUmVxdWVzdGVkU2VydmljZW5vZGVBdHRlbXB0IDwgNCkgewo=`
	result, err := base64.StdEncoding.DecodeString(patch)
	if err != nil {
		logrus.Error("Failed to decode patch:", err)
	}
	return string(result)
}
